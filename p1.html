<!DOCTYPE html>
<html>
<title>Corona Dash</title>
<head>
  <link rel="stylesheet" href="w3.css">
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<style>
  body {background-color: #b3cccc;}
  .header {
  padding: 20px;
  text-align: center;
  background: #1abc9c;
  color: white;
  font-size: 20px;
}

.divte {
  border: 1px solid gray;
  padding: 20px;
}

h1 {
  text-align: center;
  
}

p1 {
  
  text-align: justify;
  
}

</style>
</head>
<!-- Create an element where the map will take place -->
<body>
  <nav class="w3-bar w3-black">
  <a href="index.html" class="w3-button w3-bar-item">Home</a>
  <a href="p1.html" class="w3-button w3-bar-item">Corona Dashboard</a>
  <a href="p2.html" class="w3-button w3-bar-item">Previous Outbreaks</a>
  <a href="td.html" class="w3-button w3-bar-item">Compare</a>
</nav>
<div class="header">
  <h1>Covid-19</h1>
  <p>Last Updated on:</p>
</div>
<div>
  <div id="dash" class="divte"></div>
  <div  align="center"><input type="checkbox" id="show" value="true"">Show the bubble map</input></div>
 </div> 

  <br>
  <div class= "divte" align="center">
    <h1>What is Covid-19?</h1>
    <p1>
      Coronavirus disease (COVID-19) is an infectious disease caused by a newly discovered coronavirus.
      Most people who fall sick with COVID-19 will experience mild to moderate symptoms and recover without special treatment.
    </p1>
  </div>
  <h1>Trend Graph of Covid-19</h1>
  <div id= "linegraph" align="center"  ></div>
  <div class="slidecontainer" align="center">
  <input type="range" min="1" max="69" value="10" class="slider" id="jk">
  </div>
	
</body>
<script>

// The svg
let x = ""
let height = 700;
let width = 960;
let Width = 450;
let margin = 40;
var radius = Math.min(Width, height/2) / 2 - margin
let i = 0;
let r = 5;

var format = d3.format(",");

// Map and projection
var path = d3.geoPath();
var projection = d3.geoMercator()
  .scale(130)
  //.center([0,20])
  .translate([width / 2, height / 1.5]);

var color = d3.scaleOrdinal()
  .domain(["a", "b", "c"])
  .range(d3.schemeDark2);

// Data and color scale
var data = d3.map();
var colorScale = d3.scaleThreshold()
  .domain([100000, 1000000, 10000000, 30000000, 100000000, 500000000])
  .range(d3.schemeBlues[7]);

var svg = d3.select("#dash").append("svg").attr("height",700).attr("width",960);
let pcsvg = d3.select("#dash").append("svg").attr("height",700).attr("width",400) ; 
//var p = d3.select("pcsvg").append("g").attr("transform", "translate(" + Width / 2 + "," + height / 2 + ")")
d3.select("#jk").on("input",lupdate)
        let res;
        var selectTag = d3.select("select");
         var margin2 = {top: 10, right: 30, bottom: 30, left: 50},
            width2 = 550 - margin2.left - margin2.right,
            height2 = 500 - margin2.top - margin2.bottom;
        
        var svg2 = d3.select('#linegraph').append('svg').attr('width', width2).attr('height', height2).style("background-color","white").style("border", "5px solid black").style("border-radius", "20px");

        var xAxis2 = svg2.append("g")
            .attr("transform", "translate(0,430)")
        var yAxis2 =svg2.append("g") .attr("transform", "translate(50,0)");







  d3.csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv",function(error,data) {

  //ldata = data.filter(function(d) { return d.Date == "09/04/20" })
let circles = svg
      .selectAll(".mc")
      .data(data)
      
      circles.enter()
      .append("circle")
        .merge(circles)
        .attr("cx", function(d){ return projection([d.Long, d.Lat])[0] })
        .attr("cy", function(d){ return projection([d.Long, d.Lat])[1] })
        .attr("r", 5)//function(d){ return size(d.size) })
        .style("fill", "red")
        .attr("stroke", "none")
        .attr("stroke-width", 3)
        .attr("fill-opacity", .4).classed("mc",true)

  circles.exit().remove();
update();
//console.log(ldata)
//circleupdate(ldata)
})
function update(){
  d3.select("#show").each(function(d){
        
        cb = d3.select(this);
        console.log(cb.property("checked"))
        // If the box is check, I show the group
        if(cb.property("checked")){
          console.log("fggffg")
          svg.selectAll(".mc").transition().duration(1000).style("opacity", 1).attr("r",5)
          
        // Otherwise I hide it
        }else{
          
          
          svg.selectAll(".mc").transition().duration(1000).style("opacity", 0).attr("r", 0)
        }
      })
    }

    d3.selectAll("#show").on("change",update);




// Load external data and boot
d3.queue()
  .defer(d3.json,"https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")//"world_countries.json" )
  //.defer(d3.csv, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world_population.csv", function(d) { data.set(d.code, +d.pop); })
  .await(ready);

svg.append("text").attr("x",150).attr("y",150).attr("fill","red").text(x)

function ready(error, topo) {

  // Draw the map
  svg.append("g")
    .selectAll("path")
    .data(topo.features)
    .enter()
    .append("path")
      // draw each country
      .attr("d", d3.geoPath()
        .projection(projection)
      )
      // set the color of each country
      .attr("fill", "rgb(42,42,40)" ).attr("opacity",".85")
.on("mouseover",function(d,i){d3.select(this).transition()
.duration(50).attr("opacity","1")

x= d.properties.name
textupdate(x)
}).on("mouseout",function(d,i){

    tupdate()
  d3.select(this).transition().duration(50).attr("opacity",".85");});
    }

function textupdate(x)

{

//console.log(x)
d3.csv("time-series-19-covid-combined_csv.csv",function(error,data) {
ldata = data.filter(function(d) { return d.Date == "09/04/20" })
//console.log(ldata)
let kdata = ldata.filter(function(d) { return d.Country == x })
//console.log(kdata)


let text1 = pcsvg.selectAll(".tc").data(kdata);
text1.enter().append("text").merge(text1).attr("x",150).attr("y",150).style("fill","red")
.text(function(d,i){ return format(kdata[0].Confirmed)}).classed("tc",true);
//let c1 = kdata[0].Confirmed-10;
//console.log(c1)
text1.exit().remove();

let text2 = pcsvg.selectAll(".tr").data(kdata);
text2.enter().append("text").merge(text2).attr("x",150).attr("y",130).style("fill","red")
.text(function(d,i){ return format(kdata[0].Deaths)}).classed("tr",true);
text2.exit().remove();

let text3 = pcsvg.selectAll(".td").data(kdata);
text3.enter().append("text").merge(text3).attr("x",150).attr("y",110).style("fill","red")
.text(function(d,i){ return format(kdata[0].Recovered)}).classed("td",true);
text3.exit().remove();

let confirm = kdata[0].Confirmed - kdata[0].Deaths - kdata[0].Recovered; 

var data = {a: kdata[0].Recovered, b: kdata[0].Deaths , c: confirm}

pieupdate(data)

}
)
}


function tupdate()

{
 
 ndata={Confirmed: "1767855", Deaths : "108281" , Recovered : "401873"}
console.log(ndata);

let text1 = pcsvg.selectAll(".tc");
text1.data(ndata).enter().append("text").merge(text1).attr("x",150).attr("y",150).style("fill","red")
.text(function(d,i){ return ndata.Confirmed}).classed("tc",true);
text1.exit().remove();

let text2 = pcsvg.selectAll(".tr");
text2.data(ndata).enter().append("text").merge(text2).attr("x",150).attr("y",130).style("fill","red")
.text(function(d,i){ return ndata.Deaths}).classed("tr",true);
text2.exit().remove();

let text3 = pcsvg.selectAll(".td");
text3.data(ndata).enter().append("text").merge(text3).attr("x",150).attr("y",110).style("fill","red")
.text(function(d,i){ return ndata.Recovered}).classed("td",true);
text3.exit().remove();

let confirm = ndata.Confirmed - ndata.Deaths - ndata.Recovered; 
var data = {a: ndata.Recovered, b: ndata.Deaths , c: confirm}
pieupdate(data)


}
function pieupdate(data)
{


var pie = d3.pie()
    .value(function(d) {return d.value; })
    .sort(function(a, b) { console.log(a) ; return d3.ascending(a.key, b.key);} ) // This make sure that group order remains the same in the pie chart
  
var data_ready = pie(d3.entries(data))
console.log(data_ready)
var u = pcsvg.append("g").attr("transform", "translate(" + Width / 2 + "," + height / 2 + ")").selectAll("path")
    .data(data_ready)

u
    .enter()
    .append('path')
    .merge(u)
    .transition()
    .duration(1000)
    .attr('d', d3.arc()
      .innerRadius(0)
      .outerRadius(radius)
    )
    .attr('fill', function(d){ return(color(d.data.key)) })
    .attr("stroke", "white")
    .style("stroke-width", "2px")
    .style("opacity", 1)

u
    .exit()
    .remove()

}

lupdate();

       

        function lupdate(){

            let count = d3.select("#jk").property("value")
            count=parseInt(count)

        d3.csv("td2.csv",function(data){            
            var result = data.filter((d) => { return d.DAY < count; });
            var result1 = data.filter((d) => { return d.DAY == count; });
         
        

            var sumstat = d3.nest() 
            .key(function(d) { return d.Country;})
            .entries(result);

            console.log(result1)
           
            var x = d3.scaleLinear()
            .domain(d3.extent(data, function(d) { return +d.DAY; }))
            .range([ 50, width2 ]);

            xAxis2.call(d3.axisBottom(x).ticks(10));

            
            var y = d3.scaleLinear()
            .domain([0, d3.max(data, function(d) { return +d.Cases; })])
            .range([ height2-30,0]);

            
            yAxis2.call(d3.axisLeft(y));
            res = sumstat.map(function(d){ return d.key })
            //optionupdate(res)
            var color = d3.scaleOrdinal()
            .domain(res)
            .range(['#e41a1c','#377eb8','#4daf4a','#984ea3','#ff7f00','#ffff33','#a65628','#f781bf','#999999'])
      
           var lines = svg2.selectAll(".lines").data(sumstat)
           
           
            
            lines.enter()
            .append("path").attr("class","lines").merge(lines)
            .attr("fill", "none")
            .attr("stroke", "grey")
            .attr("stroke-width", 1.5)
            .attr("d", function(d){
            return d3.line()
            .x(function(d) { return x(d.DAY); })
            .y(function(d) { return y(+d.Cases); })
            (d.values)}).attr("data-legend",function(d) { return d.key}).on('mouseover', function(){d3.select(this)
            .style("opacity", 1)
            .style("stroke","red")
            .style("stroke-width",3);}).on('mouseout',function(){d3.select(this)
            .style("opacity", 1)
            .style("stroke","grey")
            .style("stroke-width",3);})


    var text = svg2.selectAll(".ltext").data(result1)

     text.enter().append("text").attr("class","ltext").merge(text)
      .attr("x", (d) => x(d.DAY))
      .attr("y", (d => y(d.Cases)))
      .attr("dy", ".35em")
      .text(function(d) { return d.Country; });

    text.exit().remove();

    var text2 = svg2.selectAll(".ltext2").data(result1)

     text2.enter().append("text").attr("class","ltext2").merge(text2)
      .attr("x", (d) => x(d.DAY))
      .attr("y", (d) => (y(d.Cases)+10))
      .attr("dy", ".35em")
      .text(function(d) { return d.Cases; });

    text2.exit().remove();

      
            
       lines.exit().remove();

                   
        })
       
        }





</script>
</html>
