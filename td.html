<html>
    <head>
      <link rel="stylesheet" href="w3.css">
        <meta charset="utf-8" />
        <title>Line</title>
        <style>
            .cbb {
                margin:auto;
            }
            .button2 {
  background-color: #008CBA; 
  color: black; 
  border: 2px solid #008CBA;
}

.button2:hover {
  background-color: blue;
  color: white;
}
        </style>
        </head>

    <body>
<nav class="w3-bar w3-black">
  <a href="index.html" class="w3-button w3-bar-item">Home</a>
  <a href="p1.html" class="w3-button w3-bar-item">Corona Dashboard</a>
  <a href="p2.html" class="w3-button w3-bar-item">Previous Outbreaks</a>
  <a href="td.html" class="w3-button w3-bar-item">Compare</a>
</nav>
        <div id= "linegraph" align="center"  >

        </div>
        <div class="slidecontainer">
            <input type="range" min="1" max="69" value="10" class="slider" id="jk">
        </div>
        <select id="c1"></select>
        <select id="c2"></select>
        <select id="c3">
        <option value="D">Deaths</option>
        <option value="C" selected>Confirmed</option>
        </select>
        <button class="button button2" onclick="compare()">compare</button>
        <div id="cc"></div>
        <select id="c5"></select>
        <select id="c4">
        <option value="D">Deaths</option>
        <option value="C" selected>Confirmed</option>
        </select>
       
    </body>
    <script src="https://d3js.org/d3.v4.js"></script>
    
    <script>
      var margin = {top: 30, right: 30, bottom: 70, left: 60},
    width = 460 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;


      var margin2 = {top: 10, right: 30, bottom: 30, left: 50},
            width2 = 550 - margin2.left - margin2.right,
            height2 = 500 - margin2.top - margin2.bottom;
        
        var svg2 = d3.select('#linegraph').append('svg').attr('width', width2).attr('height', height2).style("background-color","white").style("border", "5px solid black").style("border-radius", "20px");

var svg = d3.select("#cc")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

    var xAxis = svg.append("g")
  .attr("transform", "translate(0," + height + ")")

  var yAxis = svg.append("g")
  .attr("class", "myYaxis")
      
        var xAxis2 = svg2.append("g")
            .attr("transform", "translate(0,430)")
        var yAxis2 =svg2.append("g") .attr("transform", "translate(50,0)");
        let selectTag = d3.select("#c1");
        let selectTag2 = d3.select("#c2");
        let selectTag3 = d3.select("#c5");

        d3.select("#jk").on("input",compare)
        d3.select("#c3").on("change",compare)
        d3.select("#c4").on("change",compare2)
        d3.select("#c5").on("change",compare2)
        d3.csv("td2.csv",function(data){            
            
            var sumstat = d3.nest() 
            .key(function(d) { return d.Country;})
            .entries(data);

            res = sumstat.map(function(d){ return d.key })
            optionupdate(res)})

        function optionupdate(optionsData)
        {
          var options = selectTag.selectAll('option')
                                    .data(optionsData);
              options.enter()
                      .append('option')
                      .attr('value', function(d) {
            return d;
        }).text(function(d) {
                return d;
        });
        var options = selectTag2.selectAll('option2')
                                .data(optionsData);
        
      options.enter().append('option')
      .attr('value', function(d) {
        return d;
      })
      .text(function(d) {
        return d;
      });
      }
      compare();
      function compare()
        {
           c1 = d3.select("#c1").property("value");
           c2 = d3.select("#c2").property("value");
           c3 = d3.select("#c3").property("value");
          console.log(c1,c2,c3)
          let count = d3.select("#jk").property("value")
          count=parseInt(count)
          console.log(count)
         d3.csv("td2.csv",function(data){  
          var result = data.filter((d) => { return d.DAY < count; });
          var result1 = data.filter((d) => { return d.DAY == count; });
          
          let plottext = result1.filter((d) => { return d.Country==c1||d.Country==c2; });
          let plotdata =  result.filter((d) => { return d.Country==c1||d.Country==c2; });

          var x = d3.scaleLinear()
            .domain(d3.extent(data, function(d) { return +d.DAY; }))
            .range([ 50, width2 ]);

            xAxis2.call(d3.axisBottom(x).ticks(10));

            
            var y = d3.scaleLinear()
            .domain([0, d3.max(data, function(d) { if (c3 === "C"){return +d.Cases;} else {return +d.Deaths;} })])
            .range([ height2-30,0]);

            
            yAxis2.call(d3.axisLeft(y));

            //var sumstat2 = d3.nest() 
            //.key(function(d) { return d.Country;})
            //.entries(result);

            //console.log(sumstat2)
            var sumstat = d3.nest() 
            .key(function(d) { return d.Country;})
            .entries(plotdata);

            console.log(plotdata)//,plotdata,plottext)

            let res = sumstat.map(function(d){ return d.key });
            //console.log(res)
            //let color = d3.scaleOrdinal(d3.schemeSet3);

            var color = d3.scaleOrdinal()
            .domain(res)
            .range(['#e41a1c','#377eb8','#4daf4a','#984ea3','#ff7f00','#ffff33','#a65628','#f781bf','#999999'])

            

        var lines = svg2.selectAll(".lines").data(sumstat)

          lines.enter()
            .append("path").attr("class","lines").merge(lines)
            .attr("fill", "none")
            .attr("stroke", function(d){ return color(d.key) })
            .attr("stroke-width", 1.5)
            .attr("d", function(d){
            return d3.line()
            .x(function(d) { return x(d.DAY); })
            .y(function(d) { if (c3 === "C"){console.log("hello");return y(+d.Cases);}else {return y(+d.Deaths);} } )//
            (d.values)});//.attr("data-legend",function(d) { return d.key});


            lines.exit().remove();

          });


        

        }

        d3.csv("book2.csv",function(data){  

        console.log(data)          
            
            var sumstat = d3.nest() 
            .key(function(d) { return d.name;})
            .entries(data);
           console.log(sumstat)  

            let res2 = sumstat.map(function(d){ return d.key })
            console.log(res2)
            optionupdate2(res2)
            function optionupdate2(optionsData)
        {
          var options = selectTag3.selectAll('option')
                                    .data(optionsData);
              options.enter()
                      .append('option')
                      .attr('value', function(d) {
            return d;
        }).text(function(d) {
                return d;
        });
      }compare2();

    }

            )


        function compare2()
        {
          let c4 = d3.select("#c4").property("value");
          let c5 = d3.select("#c5").property("value");
          console.log(c4,c5)
           d3.csv("book2.csv",function(data){

          let fdata = data.filter((d) => { return d.name == c5; });
          console.log(fdata)

          if (c4=="C") 

            {
              let ldata = [{group: "COVID-19", value: fdata[0].CC},{group: "H1N1", value: fdata[0].H1N1C},{group: "SARS", value: fdata[0].SARSCASES},{group: "MERS", value: fdata[0].MERSCA}];
              
              barupdate(ldata);
            }

          else
          {
            let ldata = [{group: "COVID-19", value: fdata[0].CD},{group: "H1N1", value: fdata[0].H1N1D},{group: "SARS", value: fdata[0].SARSDEATHS},{group: "MERS", value: fdata[0].MERSD}];
            barupdate(ldata);
          }
        
          })
        }

        
      function barupdate(ldata)
      {    
          var x = d3.scaleBand()
              .range([ 0, width ])
              .padding(0.2);

          var y = d3.scaleLinear()
                .range([ height, 0]);

                x.domain(ldata.map(function(d) { return d.group; }))
                xAxis.call(d3.axisBottom(x))

                y.domain([0, d3.max(ldata, function(d) { return +d.value }) ]);
                yAxis.transition().duration(1000).call(d3.axisLeft(y));

                var u = svg.selectAll("rect")
                .data(ldata)

                u
    .enter()
    .append("rect") // Add a new rect for each new elements
    .merge(u) // get the already existing elements as well
    .transition() // and apply changes to all of them
    .duration(1000)
      .attr("x", function(d) { return x(d.group); })
      .attr("y", function(d) { return y(+d.value); })
      .attr("width", x.bandwidth())
      .attr("height", function(d) { return height - y(d.value); })
      .attr("fill", "#69b3a2")

      u
    .exit()
    .remove()

         
      }



    </script>

</html>